<!doctype html>
<html lang="en">
    <head>
        <title>Release Planner</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
    </head>

    <body>
        <header>
            <!-- place navbar here -->
        </header>
        <main>
            <h1>Release Planner</h1>
            
            <div class="container mt-5">
                <h2>Upgrade Planning Form</h2>

                <form>
                    <!-- General -->
                    <div class="mb-4">
                        <h3>General</h3>
                    </div>

                    <div class="mb-3">
                        <label for="versionName" class="form-label">Name of the version you are upgrading to:</label>
                                                <select class="form-select" id="versionName" name="versionName"></select>
                    </div>

                    <div class="mb-3">
                        <label for="numVersions" class="form-label">Number of Versions:</label>
                        <select class="form-select" id="numVersions" name="numVersions">
                            <option value="1">1 version</option>
                            <option value="2" selected>2 versions</option>
                            <option value="3">3 versions</option>
                            <option value="4">4 versions</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="upgradeStartDate" class="form-label">Upgrade Start Date:</label>
                        <input type="date" class="form-control" id="upgradeStartDate" name="upgradeStartDate">
                    </div>

                    <div class="mb-3">
                        <label for="upgradeDuration" class="form-label">Upgrade Duration (weeks):</label>
                        <input type="range" class="form-range" id="upgradeDuration" name="upgradeDuration" min="7" max="28" value="14">
                        <span id="upgradeDurationValue">14 weeks</span>
                    </div>

                    <div class="mb-3">
                        <label for="upgradeEndDate" class="form-label">Upgrade End Date:</label>
                        <input type="date" class="form-control" id="upgradeEndDate" name="upgradeEndDate">
                    </div>

                    <!-- Phases -->
                    <div class="mb-4">
                        <h3>Phases</h3>
                    </div>

                    <!-- Analysis Phase -->
                    <div class="mb-4">
                        <h4>Analysis Phase</h4>
                    </div>

                    <div class="mb-3">
                        <label for="analysisStartDate" class="form-label">Analysis Start Date:</label>
                        <input type="date" class="form-control" id="analysisStartDate" name="analysisStartDate">
                    </div>

                    <div class="mb-3">
                        <label for="analysisDuration" class="form-label">Analysis Duration (weeks):</label>
                        <input type="range" class="form-range" id="analysisDuration" name="analysisDuration" min="1" max="12" value="4">
                        <span id="analysisDurationValue">4 weeks</span>
                    </div>

                    <div class="mb-3">
                        <label for="analysisEndDate" class="form-label">Analysis End Date:</label>
                        <input type="date" class="form-control" id="analysisEndDate" name="analysisEndDate">
                    </div>

                    <!-- Build Phase -->
                    <div class="mb-4">
                        <h4>Build Phase</h4>
                    </div>

                    <div class="mb-3">
                        <label for="buildStartDate" class="form-label">Build Start Date:</label>
                        <input type="date" class="form-control" id="buildStartDate" name="buildStartDate">
                    </div>

                    <div class="mb-3">
                        <label for="buildDuration" class="form-label">Build Duration (weeks):</label>
                        <input type="range" class="form-range" id="buildDuration" name="buildDuration" min="1" max="12" value="4">
                        <span id="buildDurationValue">4 weeks</span>
                    </div>

                    <div class="mb-3">
                        <label for="buildEndDate" class="form-label">Build End Date:</label>
                        <input type="date" class="form-control" id="buildEndDate" name="buildEndDate">
                    </div>

                    <!-- Testing Phase -->
                    <div class="mb-4">
                        <h4>Testing Phase</h4>
                    </div>
                    
                    <div class="mb-3">
                        <label for="testingStartDate" class="form-label">Testing Start Date:</label>
                        <input type="date" class="form-control" id="testingStartDate" name="testingStartDate">
                    </div>

                    <div class="mb-3">
                        <label for="testingDuration" class="form-label">Testing Duration (weeks):</label>
                        <input type="range" class="form-range" id="testingDuration" name="testingDuration" min="1" max="12" value="4">
                        <span id="testingDurationValue">4 weeks</span>
                    </div>

                    <div class="mb-3">
                        <label for="testingEndDate" class="form-label">Testing End Date:</label>
                        <input type="date" class="form-control" id="testingEndDate" name="testingEndDate">
                    </div>

                    <!-- Training Phase -->
                    <div class="mb-4">
                        <h4>Training Phase</h4>
                    </div>
                    
                    <div class="mb-3">
                        <label for="trainingStartDate" class="form-label">Training Start Date:</label>
                        <input type="date" class="form-control" id="trainingStartDate" name="trainingStartDate">
                    </div>

                    <div class="mb-3">
                        <label for="trainingDuration" class="form-label">Training Duration (weeks):</label>
                        <input type="range" class="form-range" id="trainingDuration" name="trainingDuration" min="1" max="12" value="4">
                        <span id="trainingDurationValue">4 weeks</span>
                    </div>

                    <div class="mb-3">
                        <label for="trainingEndDate" class="form-label">Training End Date:</label>
                        <input type="date" class="form-control" id="trainingEndDate" name="trainingEndDate">
                    </div>

                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>

        </main>
        <footer>
            <!-- place footer here -->
        </footer>
        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>

        <script>
            // Dynamically generate the list of versions for the 3 years around today
            const versionNameSelect = document.getElementById('versionName');
            const currentYear = new Date().getFullYear();
            const nextYear = currentYear + 1;
            const months = ['February', 'May', 'August', 'November'];
            for (let year = currentYear - 1; year <= nextYear; year++) {
                for (const month of months) {
                    const monthID = `${2 + months.indexOf(month) * 3}`.padStart(2, '0');
                    const optionValue = `${year}-${monthID}`;
                    const optionText = `${month} ${year}`;
                    const option = new Option(optionText, optionValue);
                    versionNameSelect.add(option);
                }
            }

            // Set the default selected upgrade version to the closest month in the future
            const currentMonth = new Date().getMonth();
            let year = currentYear;
            if (currentMonth + 2 > 11) {
                year = nextYear;
            }
            const nextReleaseMonth = `${Math.floor(((currentMonth + 2) % 12) / 3) * 3 + 2}`.padStart(2, '0');
            const nextReleaseversion = `${year}-${nextReleaseMonth}`;
            const defaultOption = versionNameSelect.querySelector(`[value="${nextReleaseversion}"]`);
            if (defaultOption) {
                defaultOption.selected = true;
            }
            
            // Set the default upgradeStartDate to be the Monday in 4 weeks
            const upgradeStartDateInput = document.getElementById('upgradeStartDate');
            const today = new Date();
            // 3 weeks * 7 days * 24 hours * 60 minutes * 60 seconds * 1000 milliseconds
            const mondayInFourWeeks = new Date(today.getTime() + 3 * 7 * 24 * 60 * 60 * 1000);
            // Find the next Monday
            mondayInFourWeeks.setDate(mondayInFourWeeks.getDate() + (1 + 7 - mondayInFourWeeks.getDay()) % 7);
            // Format the date as 'YYYY-MM-DD' for the input field
            const formattedDate = `${mondayInFourWeeks.getFullYear()}-${(mondayInFourWeeks.getMonth() + 1).toString().padStart(2, '0')}-${mondayInFourWeeks.getDate().toString().padStart(2, '0')}`;
            upgradeStartDateInput.value = formattedDate;

            // Update upgrade duration value
            const upgradeDurationInput = document.getElementById('upgradeDuration');
            const upgradeDurationValue = document.getElementById('upgradeDurationValue');
            const numVersionsSelect = document.getElementById('numVersions');
            
            function changeNumVersions() {
                const numVersions = parseInt(numVersionsSelect.value);
                const calculatedDuration = 7 * numVersions;
                
                upgradeDurationInput.value = calculatedDuration;
                upgradeDurationValue.textContent = `${calculatedDuration} weeks`;
                updateUpgradeEndDate();
            }
            numVersionsSelect.addEventListener('change', changeNumVersions);
            upgradeDurationInput.addEventListener('input', () => {
                upgradeDurationValue.textContent = `${upgradeDurationInput.value} weeks`;
            });

            // Set upgradeEndDate based on upgradeStartDate and upgradeDuration, and update when one of these change
            const upgradeEndDateInput = document.getElementById('upgradeEndDate');

            function updateUpgradeEndDate() {
                const startDate = new Date(upgradeStartDateInput.value);
                const durationWeeks = parseInt(upgradeDurationInput.value);
                
                if (!isNaN(startDate.getTime()) && !isNaN(durationWeeks)) {
                    const endDate = new Date(startDate.getTime() + durationWeeks * 7 * 24 * 60 * 60 * 1000); // Convert weeks to milliseconds
                    upgradeEndDateInput.valueAsDate = endDate;
                } else {
                    upgradeEndDateInput.value = ''; // Clear the value if inputs are not valid
                }
            }
            // Set initial upgradeEndDate
            updateUpgradeEndDate();
            // Add event listeners to recalculate upgradeEndDate on input changes
            upgradeStartDateInput.addEventListener('input', updateUpgradeEndDate);
            upgradeDurationInput.addEventListener('input', updateUpgradeEndDate);

            // Update analysis duration value
            const analysisDurationInput = document.getElementById('analysisDuration');
            const analysisDurationValue = document.getElementById('analysisDurationValue');
            analysisDurationInput.addEventListener('input', () => {
                analysisDurationValue.textContent = `${analysisDurationInput.value} weeks`;
            });

            // Update build duration value
            const buildDurationInput = document.getElementById('buildDuration');
            const buildDurationValue = document.getElementById('buildDurationValue');
            buildDurationInput.addEventListener('input', () => {
                buildDurationValue.textContent = `${buildDurationInput.value} weeks`;
            });
        
            // Update testing duration value
            const testingDurationInput = document.getElementById('testingDuration');
            const testingDurationValue = document.getElementById('testingDurationValue');
            testingDurationInput.addEventListener('input', () => {
                testingDurationValue.textContent = `${testingDurationInput.value} weeks`;
            });
        
            // Update training duration value
            const trainingDurationInput = document.getElementById('trainingDuration');
            const trainingDurationValue = document.getElementById('trainingDurationValue');
            trainingDurationInput.addEventListener('input', () => {
                trainingDurationValue.textContent = `${trainingDurationInput.value} weeks`;
            });
        </script>
    </body>
</html>
